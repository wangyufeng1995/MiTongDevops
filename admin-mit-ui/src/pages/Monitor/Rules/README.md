# 告警规则管理模块

## 功能概述

告警规则管理模块提供了完整的告警规则配置和管理功能，支持对主机监控指标设置告警条件，并通过多种渠道发送告警通知。

## 主要功能

### 1. 规则列表 (RuleList.tsx)

- **规则展示**：以表格形式展示所有告警规则
- **多维度筛选**：
  - 关键词搜索（规则名称、描述）
  - 监控指标筛选（CPU、内存、磁盘、负载）
  - 严重级别筛选（信息、警告、严重）
  - 状态筛选（已启用、已禁用）
- **统计卡片**：显示总规则数、已启用、已禁用、严重级别规则数量
- **快速操作**：
  - 启用/禁用规则
  - 编辑规则
  - 删除规则
- **分页支持**：支持自定义每页显示数量和快速跳转

### 2. 规则表单 (RuleForm.tsx)

#### 基本信息
- 规则名称（必填）
- 规则描述

#### 监控条件
- **监控指标**：CPU使用率、内存使用率、磁盘使用率、系统负载
- **条件操作符**：>、>=、<、<=、==
- **阈值**：0-100%
- **持续时间**：条件持续多久后触发告警（秒）
- **严重级别**：信息、警告、严重
- **静默期**：同一告警的最小间隔时间（秒）

#### 应用范围
- 应用到所有主机
- 或选择特定主机

#### 告警渠道
- 支持选择多个告警渠道
- 显示渠道类型（邮件、钉钉等）

#### 规则状态
- 启用/禁用规则

## 技术特性

### UI/UX
- **响应式设计**：适配桌面和移动设备
- **深色模式支持**：自动适配系统主题
- **实时反馈**：Toast提示、加载状态、错误提示
- **表单验证**：实时验证用户输入
- **确认对话框**：删除操作需要二次确认

### 数据交互
- **RESTful API**：与后端API完全对接
- **分页加载**：支持大量数据的高效展示
- **防抖搜索**：优化搜索性能
- **权限控制**：基于用户权限显示操作按钮

### 组件复用
- 使用 `MonitorPageLayout` 统一页面布局
- 使用 `MonitorContentCard` 统一内容卡片样式
- 使用 `MonitorStatCard` 统一统计卡片样式
- 使用 `DataTable` 统一表格展示
- 使用 `ConfirmDialog` 统一确认对话框

## API接口

### 获取规则列表
```
GET /api/monitor/rules
参数：
  - page: 页码
  - per_page: 每页数量
  - search: 搜索关键词
  - metric_type: 监控指标
  - severity: 严重级别
  - enabled: 启用状态
```

### 创建规则
```
POST /api/monitor/rules
请求体：FormData
```

### 更新规则
```
PUT /api/monitor/rules/:id
请求体：FormData
```

### 删除规则
```
POST /api/monitor/rules/:id/delete
```

### 启用规则
```
POST /api/monitor/rules/:id/enable
```

### 禁用规则
```
POST /api/monitor/rules/:id/disable
```

### 获取规则详情
```
GET /api/monitor/rules/:id
```

## 使用示例

### 创建CPU告警规则

1. 点击"创建规则"按钮
2. 填写规则名称：生产服务器CPU告警
3. 选择监控指标：CPU使用率
4. 设置条件：> 80%
5. 设置持续时间：300秒（5分钟）
6. 选择严重级别：警告
7. 选择应用范围：所有主机或特定主机
8. 选择告警渠道：邮件、钉钉等
9. 启用规则
10. 点击"创建规则"保存

### 编辑规则

1. 在规则列表中点击"编辑"按钮
2. 修改需要更改的字段
3. 点击"更新规则"保存

### 启用/禁用规则

- 在规则列表中点击电源图标即可快速启用或禁用规则

### 删除规则

1. 在规则列表中点击"删除"按钮
2. 在确认对话框中确认删除操作

## 注意事项

1. **告警渠道**：创建规则前需要先配置告警渠道
2. **主机选择**：如果不选择"应用到所有主机"，必须至少选择一台主机
3. **阈值范围**：阈值必须在0-100之间
4. **删除限制**：有活跃告警记录的规则无法删除
5. **权限要求**：
   - 创建规则需要 `monitor:create` 权限
   - 更新规则需要 `monitor:update` 权限
   - 删除规则需要 `monitor:delete` 权限

## 后续优化建议

1. **批量操作**：支持批量启用/禁用/删除规则
2. **规则模板**：提供常用规则模板快速创建
3. **规则测试**：支持规则测试功能
4. **告警预览**：预览规则触发后的告警内容
5. **规则复制**：支持复制现有规则快速创建新规则
6. **导入导出**：支持规则的导入导出功能
7. **规则分组**：支持规则分组管理
8. **告警统计**：显示每个规则的告警统计图表
