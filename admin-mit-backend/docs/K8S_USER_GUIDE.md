# K8S运维管理系统使用指南

## 概述

K8S运维管理系统为运维人员提供统一的Kubernetes集群管理界面，支持多集群管理、资源查看、配置管理等核心功能。

## 功能模块

### 1. 集群管理

#### 1.1 添加集群

1. 进入"K8S管理" > "集群管理"页面
2. 点击"添加集群"按钮
3. 填写集群信息：
   - **集群名称**: 唯一标识集群的名称
   - **API服务器地址**: Kubernetes API Server地址（如：https://k8s.example.com:6443）
   - **认证方式**: 选择Token或Kubeconfig
   - **Token/Kubeconfig**: 根据认证方式填写相应凭证
   - **描述**: 可选的集群描述信息
4. 点击"测试连接"验证配置
5. 点击"保存"完成添加

#### 1.2 查看集群状态

集群列表页面显示：
- 集群名称和API地址
- 在线状态（绿色-在线，红色-离线）
- 节点数量、Pod数量、命名空间数量
- 最后连接时间

#### 1.3 编辑/删除集群

- 点击集群行的"编辑"按钮修改集群配置
- 点击"删除"按钮删除集群（需确认）

### 2. 命名空间管理

#### 2.1 查看命名空间

1. 在集群选择器中选择目标集群
2. 系统自动加载该集群的命名空间列表
3. 支持按名称搜索和分页浏览

#### 2.2 创建命名空间

1. 点击"创建命名空间"按钮
2. 输入命名空间名称（需符合K8S命名规范）
3. 点击"确定"创建

#### 2.3 删除命名空间

- 点击命名空间行的"删除"按钮
- 系统会警告将删除该命名空间下所有资源
- 确认后执行删除

### 3. 工作负载管理

#### 3.1 查看工作负载

支持查看三种类型的工作负载：
- **Deployment**: 无状态应用部署
- **StatefulSet**: 有状态应用部署
- **DaemonSet**: 守护进程部署

每个工作负载显示：
- 名称和命名空间
- 副本数（期望/可用）
- 镜像版本
- 创建时间

#### 3.2 扩缩容

1. 点击工作负载行的"扩缩容"按钮
2. 输入新的副本数（0-100）
3. 点击"确定"执行扩缩容

#### 3.3 重启工作负载

- 点击"重启"按钮执行滚动重启
- 系统会逐个重启Pod，确保服务不中断

#### 3.4 查看Pod日志

1. 点击工作负载进入详情页
2. 在Pod列表中选择目标Pod
3. 点击"查看日志"按钮
4. 支持实时日志流和历史日志查看

### 4. 服务发现管理

#### 4.1 Service管理

查看Service列表，包含：
- 服务名称和类型（ClusterIP/NodePort/LoadBalancer）
- ClusterIP地址
- 端口映射
- 选择器标签

#### 4.2 Ingress管理

查看Ingress列表，包含：
- Ingress名称
- 域名和路径规则
- 后端服务配置

### 5. 配置管理

#### 5.1 ConfigMap管理

- 查看ConfigMap列表和详情
- 创建新的ConfigMap（键值对形式）
- 删除ConfigMap（会检查是否被使用）

#### 5.2 Secret管理

- 查看Secret列表（敏感数据脱敏显示）
- 创建新的Secret（自动Base64编码）
- 删除Secret（会检查是否被使用）

### 6. 存储管理

#### 6.1 PersistentVolume (PV)

查看PV列表，包含：
- 存储容量
- 访问模式
- 回收策略
- 状态（Available/Bound/Released）

#### 6.2 PersistentVolumeClaim (PVC)

查看PVC列表，包含：
- 请求容量
- 绑定的PV
- 使用状态

#### 6.3 StorageClass

查看StorageClass列表，包含：
- 存储类名称
- 供应商
- 参数配置

## 权限说明

### 角色权限

| 功能 | 普通用户 | 运维管理员 | 超级管理员 |
|------|---------|-----------|-----------|
| 查看集群列表 | ✓ | ✓ | ✓ |
| 添加/编辑/删除集群 | ✗ | ✓ | ✓ |
| 查看资源 | ✓ | ✓ | ✓ |
| 创建/删除命名空间 | ✗ | ✓ | ✓ |
| 扩缩容/重启工作负载 | ✗ | ✓ | ✓ |
| 创建/删除配置 | ✗ | ✓ | ✓ |

### 多租户隔离

- 每个租户只能看到自己的集群
- 集群数据完全隔离
- 操作日志按租户分离

## 审计日志

所有K8S操作都会记录审计日志，包括：
- 操作时间
- 操作用户
- 操作类型（创建/更新/删除/扩缩容/重启）
- 资源类型和名称
- 操作结果（成功/失败）
- 错误信息（如有）

查看审计日志：
1. 进入"K8S管理" > "操作日志"
2. 支持按集群、操作类型、时间范围筛选

## 常见问题

### Q1: 集群连接失败怎么办？

1. 检查API服务器地址是否正确
2. 验证网络连接是否正常
3. 确认防火墙规则是否允许访问
4. 检查Token/Kubeconfig是否有效

### Q2: 为什么看不到某些资源？

1. 确认已选择正确的集群和命名空间
2. 检查当前用户是否有查看权限
3. 验证K8S集群中确实存在该资源

### Q3: 扩缩容操作失败？

1. 检查副本数是否在有效范围内（0-100）
2. 确认集群资源是否充足
3. 查看K8S事件了解详细错误原因

### Q4: 删除配置时提示"正在使用"？

系统会检查ConfigMap/Secret是否被工作负载引用，如果正在使用则不允许删除。请先修改工作负载配置后再删除。
